<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ng="http://angularjs.org" xml:lang="en" lang="en">

<head>
    <script type="text/javascript" ng:autobind src="js/angular-0.9.9.min.js"></script>
    <script type="text/javascript" src="js/jquery-1.5.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min-1.7.1.js"></script>
    <script type="text/javascript" src="js/jquery-framedialog-1.1.2.js"></script>
    <link rel="stylesheet" type="text/css" href="style/jbehave-navigator.css"/>
    <link rel="stylesheet" type="text/css" href="style/jquery-ui.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>JBehave Story Navigator</title>
</head>

<body ng:controller="MyController">

<script type="text/javascript">
    MyController.$inject = ["$resource"];
    function MyController($resource) {
        this.Story = $resource("xref.json");
        this.data = this.Story.get({});
    }
    MyController.prototype = {
        showResults: function(story) {

            jQuery.FrameDialog.create({
                width: 1000,
                height: 600,
                closeText: 'foo',
                url: story.html,
                title: 'Results For ' + story.path,
                closeOnEscape: true,
                buttons: [
                    {
                    }
                ]
            })
        },
        showScenarios: function(story) {

            var $dialog = $('<div></div>')
                    .html('<pre>' + story.scenarios.replace("\n", "<br>") + '</pre>')
                    .dialog({
                                width: 800,
                                height: 400,
                                autoOpen: false,
                                title: 'Scenarios for ' + story.path
                            });

            $dialog.dialog('open');
            // prevent the default action, e.g., following a link
        },
        openEditTab: function(story) {
            alert("TODO");
        }
    };
    angular.filter('newlines', function(text) {
        return text.replace(/\n/g, '<br/>');
    });
		
		$(document).ready(function() {
        function resetHeaders() {
					$('thead tr th a').css('color', '#3199ee');
					$('thead tr th a').css('background-image', 'none');
        }

				//STATUS
        $('#status-des').click(function() {
					resetHeaders();
					$('#status-asc').css('color', '#f90');
					$('#status-asc').css('background-image', 'url(images/orange-arrow-down.png)');
					$('#status-asc').show();
					$(this).hide();
        });
				
        $('#status-asc').click(function() {
					resetHeaders();
					$('#status-des').css('color', '#f90');
					$('#status-des').css('background-image', 'url(images/orange-arrow-up.png)');
					$('#status-des').show();
					$(this).hide();
        });

        //PATH
        $('#path-des').click(function() {
					resetHeaders();
					$('#path-asc').css('color', '#f90');
					$('#path-asc').css('background-image', 'url(images/orange-arrow-down.png)');
					$('#path-asc').show();
					$(this).hide();
        });
        
        $('#path-asc').click(function() {
					resetHeaders();
					$('#path-des').css('color', '#f90');
					$('#path-des').css('background-image', 'url(images/orange-arrow-up.png)');
					$('#path-des').show();
					$(this).hide();
        });

        //DESCRIPTION
        $('#description-des').click(function() {
					resetHeaders();
					$('#description-asc').css('color', '#f90');
					$('#description-asc').css('background-image', 'url(images/orange-arrow-down.png)');
					$('#description-asc').show();
					$(this).hide();
        });
        $('#description-asc').click(function() {
					resetHeaders();
					$('#description-des').css('color', '#f90');
					$('#description-des').css('background-image', 'url(images/orange-arrow-up.png)');
					$('#description-des').show();
					$(this).hide();
        });

        //META
        $('#meta-des').click(function() {
					resetHeaders();
					$('#meta-asc').css('color', '#f90');
					$('#meta-asc').css('background-image', 'url(images/orange-arrow-down.png)');
					$('#meta-asc').show();
					$(this).hide();
        });
        $('#meta-asc').click(function() {
					resetHeaders();
					$('#meta-des').css('color', '#f90');
					$('#meta-des').css('background-image', 'url(images/orange-arrow-up.png)');
					$('#meta-des').show();
					$(this).hide();
        });

        //NARRATIVE
        $('#narrative-des').click(function() {
					resetHeaders();
					$('#narrative-asc').css('color', '#f90');
					$('#narrative-asc').css('background-image', 'url(images/orange-arrow-down.png)');
					$('#narrative-asc').show();
					$(this).hide();
        });
        $('#narrative-asc').click(function() {
					resetHeaders();
					$('#narrative-des').css('color', '#f90');
					$('#narrative-des').css('background-image', 'url(images/orange-arrow-up.png)');
					$('#narrative-des').show();
					$(this).hide();
        })

    })
</script>

<div id="page-wrap">
    <div id="inside">
        <div id="header">
            <a href="http://www.jbehave.org"><img src="images/jbehave-logo.png" alt="header"/></a>
        </div>
        <div id="main-content">
            <table summary="JBehave Navigator" cellspacing="0" cellpadding="0">
            	<thead>
            		<!--
                <tr>
                    <th colspan="5">Use columns to filter stories by content and/or search text in scenarios: <input name="search.scenarios"/></th>
                </tr>
								-->
                <tr>
                  <th class="status">
                    <a href id="status-asc" ng:click="predicate = 'passed'">Status</a>
										<a href id="status-des" ng:click="predicate = '-passed'">Status</a>
                  </th>
                  <th class="path">
                  	<a href id="path-asc" ng:click="predicate = 'path'">Path</a>
										<a href id="path-des" ng:click="predicate = '-path'">Path</a>
                  </th>
                  <th class="description">
                    <a href id="description-asc" ng:click="predicate = 'description'">Description</a>
										<a href id="description-des" ng:click="predicate = '-description'">Description</a>
                  </th>
                  <th class="meta">
                  	<a href id="meta-asc" ng:click="predicate = 'meta'">Meta</a>
										<a href id="meta-des" ng:click="predicate = '-meta'">Meta</a>
                  </th>
                  <th class="narrative">
										<a href id="narrative-asc" ng:click="predicate = 'narrative'">Narrative</a>
										<a href id="narrative-des" ng:click="predicate = '-narrative'">Narrative</a>
                  </th>
                  <th class="view">View</th>
                </tr>
                <tr>
                  <th class="status"></th>
                  <th class="path"><input name="search.path" class="filterInput"/></th>
                  <th class="description"><input name="search.description" class="filterInput"/></th>
                  <th class="meta">
                  	<select name="search.meta" class="filterInput">
                      <option value="=" selected="selected">**All**</option>
                      <option ng:repeat="permutation in data.xref.meta">{{permutation}}</option>
                    </select></th>
                  <th class="narrative"><input name="search.narrative" class="filterInput"/></th>
                  <th class="view"></th>
                </tr>
							</thead>
							<tbody>
                <tr ng:repeat="story in data.xref.stories.$filter(search).$orderBy(predicate)"
										ng:click="showResults(story)" title="Click to view the story details">
                  <td class="status"><img src="images/passed-{{story.passed}}.png" alt="Story Passed == {{story.passed}}"/></td>
                  <td class="path">{{story.path}}</td>
                  <td class="description">{{story.description}}</td>
                  <td class="meta">{{story.meta}}</td>
                  <td class="narrative">{{story.narrative | newlines | html}}</td>
                  <td class="view">
                      <a href ng:click="showResults(story)">Results</a><br/>
                      <a href ng:click="showScenarios(story)">Scenarios</a>
                      <!--button ng:click="openEditTab(story)">Edit</button-->
                  </td>
                </tr>
							</tbody>
            </table>

            <hr/>

            <h2>Steps</h2>
            <table cellspacing="0" cellpadding="0">
	          <thead>
                <tr>
                  <th>Type</th>
                  <th>Pattern</th>
                  <th>Use Count</th>
                </tr>
                <tr>
	              <th>
	              	<select ng:init="stepSearch.type = ''" name="stepSearch.type" class="filterInput">
	                  <option value="" selected="selected">**All**</option>
	                  <option selected>GIVEN</option>
	                  <option selected>WHEN</option>
	                  <option selected>THEN</option>
	                </select>
	              </th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>


              <tbody>
                <tr ng:repeat="match in data.xref.stepMatches.$filter(stepSearch)">
                  <td>{{match.type}}</td>
                  <td>{{match.annotatedPattern}}</td>
                  <td>{{match.usages.$size()}}</td>
                 </tr>
              </tbody>
            </table>

        </div>
        <div id="footer">
           <div class="left">Data Generated by {{data.xref.whatMadeThis}} on {{ data.xref.whenMade | date:'yyyy-MM-dd HH:mm:ss'}}</div>
            <div class="clear"></div>
        </div>
        <div style="clear: both;"></div>
    </div>
</body>
</html>