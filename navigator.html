<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ng="http://angularjs.org" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" ng:autobind src="js/angular-0.9.19.min.js"></script>
    <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.17.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery-framedialog-1.1.2.js"></script>
    <link rel="stylesheet" type="text/css" href="style/navigator.css"/>
    <link rel="stylesheet" type="text/css" href="style/jquery-ui.css"/>
    <title>Story Navigator</title>
</head>
<body ng:controller="MyController">

<script type="text/javascript">
    function MyController($resource) {
        this.data = $resource("xref.json").get({});
        this.c = {};
        this.ord = 'passed';

        // show a single story.
        this.showResults = function(story) {
            jQuery.FrameDialog.create({
                width: 1000,
                height: 600,
                closeText: 'foo',
                url: story.html,
                title: 'Results For ' + story.path,
                closeOnEscape: true,
                buttons: [
                    {
                    }
                ]
            })
        };
    }

    MyController.$inject = ["$resource"];

    // Sometimes story next has newline chars in it.
    angular.filter('newlines', function(text) {
        return text.replace(/\n/g, '<br/>');
    });

    // One tab for Stories, one for Steps.
    $(document).ready(function() {
        $("#tabs").tabs();
    });
</script>

<div id="page-wrap">
    <div id="inside">
        <div id="header">
            <a href="http://www.jbehave.org"><img src="images/jbehave-logo.png" alt="header"/></a>
        </div>
        <div id="main-content">

            <div id="tabs">
                <ul>
                    <li><a href="#tabs-1">Stories ({{data.xref.stories.$size()}})</a></li>
                    <li><a href="#tabs-2">Steps</a></li>
                </ul>
                
                <!-- The Story List Tab -->
	            <div id="tabs-1">
		            <span></span>
	
                    <table summary="Navigator" cellspacing="0" cellpadding="0">
                        <thead>
                        <tr>
                            <th colspan="2" class="section">
                            	Stories<br/>
                            	<p id="stories-total">Showing {{data.xref.stories.$filter(search).$size()}} of {{data.xref.stories.$size()}} stories</p>
                            </th>
                            <th colspan="5" class="section filter">
                            	Filter scenarios<input name="search.scenarios" class="filterInput"/>
	                            <div id="view-selector">
								<label>View:</label>
								<ul>
									<li><input type="checkbox" class="show_hide" name="c.status" checked="true"> Status</input></li>
									<li><input type="checkbox" class="show_hide" name="c.path" checked="true"> Path</input></li>
									<li><input type="checkbox" class="show_hide" name="c.description" checked="true"> Description</input></li>
									<li><input type="checkbox" class="show_hide" name="c.meta" checked="true"> Meta</input></li>
									<li><input type="checkbox" class="show_hide" name="c.narrative" checked="true"> Narrative</input></li>
									<li><input type="checkbox" class="show_hide" name="c.started" checked="true"> Started </input></li>
									<li><input type="checkbox" class="show_hide" name="c.duration" checked="true"> Duration </input></li>
								</ul>
							</div>
                            </th>
                        </tr>
                        <tr class="columnTitles">
                            <th style="white-space: nowrap;" ng:show="c.status" class="status first">
	                            <span ng:show="ord != '-passed' &amp;&amp; ord != 'passed' " ng:click="ord = 'passed'">Status<img src="images/arrow-blank.png"/></span>
                                <span ng:show="ord == '-passed'" ng:click="ord = 'passed'">Status<img src="images/arrow-up.png"/></span>
                                <span ng:show="ord == 'passed'" ng:click="ord = '-passed'">Status<img src="images/arrow-down.png"/></span>
                            </th>
                            <th style="white-space: nowrap;" ng:show="c.path" class="path">
	                            <span ng:show="ord != '-path' &amp;&amp; ord != 'path' " ng:click="ord = 'path'">Path<img src="images/arrow-blank.png"/></span>
                                <span ng:show="ord == '-path'" ng:click="ord = 'path'">Path<img src="images/arrow-up.png"/></span>
                                <span ng:show="ord == 'path'" ng:click="ord = '-path'">Path<img src="images/arrow-down.png"/></span>
                            </th>
							<th style="white-space: nowrap;" ng:show="c.description" class="description">
	                            <span ng:show="ord != '-description' &amp;&amp; ord != 'description' " ng:click="ord = 'description'">Description<img src="images/arrow-blank.png"/></span>
							    <span ng:show="ord == '-description'" ng:click="ord = 'description'">Description<img src="images/arrow-up.png"/></span>
							    <span ng:show="ord == 'description'" ng:click="ord = '-description'">Description<img src="images/arrow-down.png"/></span>
							</th>
							<th style="white-space: nowrap;" ng:show="c.meta" class="meta">
	                            <span ng:show="ord != '-meta' &amp;&amp; ord != 'meta' " ng:click="ord = 'meta'">Meta<img src="images/arrow-blank.png"/></span>
							    <span ng:show="ord == '-meta'" ng:click="ord = 'meta'">Meta<img src="images/arrow-up.png"/></span>
							    <span ng:show="ord == 'meta'" ng:click="ord = '-meta'">Meta<img src="images/arrow-down.png"/></span>
							</th>
							<th style="white-space: nowrap;" ng:show="c.narrative" class="narrative">
	                            <span ng:show="ord != '-narrative' &amp;&amp; ord != 'narrative' " ng:click="ord = 'narrative'">Narrative<img src="images/arrow-blank.png"/></span>
							    <span ng:show="ord == '-narrative'" ng:click="ord = 'narrative'">narrative<img src="images/arrow-up.png"/></span>
							    <span ng:show="ord == 'narrative'" ng:click="ord = '-narrative'">narrative<img src="images/arrow-down.png"/></span>
							</th>
							<th style="white-space: nowrap;" ng:show="c.started" class="started">
	                            <span ng:show="ord != '-started' &amp;&amp; ord != 'started' " ng:click="ord = 'started'">Started<img src="images/arrow-blank.png"/></span>
							    <span ng:show="ord == '-started'" ng:click="ord = 'started'">Started<img src="images/arrow-up.png"/></span>
							    <span ng:show="ord == 'started'" ng:click="ord = '-started'">Started<img src="images/arrow-down.png"/></span>
							</th>
							<th style="white-space: nowrap;" ng:show="c.duration" class="duration">
	                            <span ng:show="ord != '-duration' &amp;&amp; ord != 'duration' " ng:click="ord = 'duration'">Duration<img src="images/arrow-blank.png"/></span>
							    <span ng:show="ord == '-duration'" ng:click="ord = 'duration'">Duration<img src="images/arrow-up.png"/></span>
							    <span ng:show="ord == 'duration'" ng:click="ord = '-duration'">Duration<img src="images/arrow-down.png"/></span>
							</th>
                        </tr>
                        <tr>
                            <th ng:show="c.status" class="status filterLabel">Filter</th>
                            <th ng:show="c.path" class="path"><input name="search.path" class="filterInput"/></th>
                            <th ng:show="c.description" class="description"><input name="search.description" class="filterInput"/></th>
                            <th ng:show="c.meta" class="meta">
                                <select name="search.meta" class="filterInput">
                                    <option value="=" selected="selected">- All -</option>
                                    <option ng:repeat="permutation in data.xref.meta">{{permutation}}</option>
                                </select></th>
                            <th ng:show="c.narrative" class="narrative"><input name="search.narrative" class="filterInput"/></th>
                            <th ng:show="c.started" class="started"/>
                            <th ng:show="c.duration" class="duration total">{{data.xref.stories.$filter(search).$sum('duration') /1000 | number:0}} secs</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng:repeat="story in data.xref.stories.$filter(search).$orderBy(ord)"
                            ng:click="showResults(story)" title="Click to view the story details">
                            <td ng:show="c.status" class="status"><img src="images/passed-{{story.passed}}.png"
                                                    alt="Story Passed == {{story.passed}}"/></td>
                            <td ng:show="c.path" class="path">{{story.path}}</td>
                            <td ng:show="c.description" class="description">{{story.description}}</td>
                            <td ng:show="c.meta" class="meta">{{story.meta}}</td>
                            <td ng:show="c.narrative" class="narrative">{{story.narrative | newlines | html}}</td>
                            <td ng:show="c.started" class="started">
                                <div>{{story.started | date:'MM-dd-yyyy'}}</div>
                                <div>{{story.started | date:'HH:mm:ss'}}</div>
                            </td>
                            <td ng:show="c.duration" class="duration">{{story.duration / 1000 | number:1}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- The Step-Match List Tab -->

                <div id="tabs-2">
                    <table cellspacing="0" cellpadding="0">
                        <thead>
                        <tr>
                            <th colspan="3" class="section">Steps</th>
                        </tr>
                        <tr class="columnTitles">
                            <th class="type first">
                                <a href id="type-asc" class="ascending" ng:click="stepPredicate = 'type'">Type</a>
                                <a href id="type-des" class="descending" ng:click="stepPredicate = '-type'">Type</a>
                            </th>
                            <th class="pattern">
                                <a href id="pattern-asc" class="ascending"
                                   ng:click="stepPredicate = 'annotatedPattern'">Pattern</a>
                                <a href id="pattern-des" class="descending"
                                   ng:click="stepPredicate = '-annotatedPattern'">Pattern</a>
                            </th>
                            <th class="usages last">
                                <a href id="usages-asc" class="ascending" ng:click="stepPredicate = 'usages.$size()'">Usages</a>
                                <a href id="usages-des" class="descending" ng:click="stepPredicate = '-usages.$size()'">Usages</a>
                            </th>
                        </tr>
                        <tr class="filters">
                            <th>
                                <select ng:init="stepSearch.type = ''" name="stepSearch.type" class="filterInput">
                                    <option value="" selected="selected">- All -</option>
                                    <option selected>Given</option>
                                    <option selected>When</option>
                                    <option selected>Then</option>
                                </select>
                            </th>
                            <th><input name="stepSearch.annotatedPattern" class="filterInput"/></th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng:repeat="match in data.xref.stepMatches.$filter(stepSearch).$orderBy(stepPredicate)">
                            <td class="type">{{match.type}}</td>
                            <td class="pattern">{{match.annotatedPattern}}</td>
                            <td class="size">{{match.usages.$size()}}</td>
                            <!-- <td class="size">{{match.usages[0].story}}</td> -->
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="footer">
            <div class="left">Data Generated by {{data.xref.whatMadeThis}} on {{ data.xref.whenMade | date:'yyyy-MM-dd
                HH:mm:ss'}}
            </div>
            <div class="clear"></div>
        </div>

        <div style="clear: both;"></div>
    </div>
</div>
</body>
</html>